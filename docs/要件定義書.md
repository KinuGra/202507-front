# みんはや風クイズアプリ 要件整理ドキュメント

---

## ✅ 1. 目的・対象ユーザー

- **目的**  
  クイズが好きな一般ユーザー向けに、リアルタイム対戦型の早押しクイズを提供する。

- **対象**  
  学生・社会人など幅広い層。ゲストプレイも可能(検討事項)。

---

## ✅ 2. 必須機能

| 機能 | 詳細 |
|------|------|
| ユーザー登録/ログイン | AWS CognitoによるID管理を採用。ゲストでも参加可能。 |
| ルーム作成/参加 | プレイヤーが対戦ルームを作成し、他プレイヤーが参加できる。 |
| ルーム内リアルタイム通信 | 問題出題、回答送信、スコア更新をWebSocketでリアルタイム同期。 |
| ゲームロジック | 進行状況（出題順序、勝敗判定、スコア計算）を管理。 |

---

## ✅ 3. 追加機能

| 機能 | ステータス | 補足 |
|------|------------|------|
| ランダムマッチング | 要検討 | 完全ランダム、後から実装予定。 |
| CPU補完 | 追加機能 | 不足人数をAIで埋める。 |
| フレンド機能 | 多分いらない | MVPでは未実装。 |
| 近くの人と対戦（WebRTC） | 追加機能 | P2P構成の検討が必要。 |
| ユーザーの問題投稿 | 要検討 | クイズIDで問題テーブルを分割。承認フローは要検討。 |
| ランキング | 必要 | 1ゲーム内ランキング、総合ランキングなど。 |
| Discord Bot連携 | 導入予定 | ユーザーがDiscord上で戦績確認・練習クイズが可能。戦績確認にはOAuthで`discord_id`紐付けを行うか検討中。 |

---

## ✅ 4. ゲーム仕様（現時点）

- **1ルーム最大人数**：10人程度（未確定）
- **勝利条件**：N問正解した人が勝利。1位のみ確定。
- **勝敗記録**：レート（勝敗だけでいい？）をトップ画面に表示。
- **出題形式**：みんはやLike

---

## ✅ 5. システム構成（現時点）

- **フロントエンド**：Next.js
- **認証基盤**：AWS Cognito
- **リアルタイム通信**：WebSocketサーバー（Django）
- **問題データ**：自作＆ユーザー投稿をDBで管理（クイズIDでテーブル分割）
- **ユーザーデータ**：認証はCognito、プロフィールや対戦履歴は別DB（例：Supabaseなど）

---

## ✅ 6. データベース構造（要点）

### User
- uuid, username, icon, loginid, password, created_at
- ゲストユーザーのレコードは定期削除。

### Room / room_participants / answer
- ルーム単位で一時的に参加者と回答を紐付ける。
- 終了後に削除または履歴DBに保存。

### Summary
- 1プレイごとの対戦結果を保存（総出題数、正答数、最終順位など）。

### Ranking
- 1ゲーム内ランキングを計算、終了時にSummaryに反映。

### QuizData1〜N
- クイズ問題テーブル群（自作＋ユーザー投稿）。
- クイズIDでテーブル分割。

---

## ✅ 7. スケーラビリティの方向性

- MVPでは負荷対策は最小限でOK。
- 将来的には：
  - WebSocketを複数サーバーで水平スケール（Redis Pub/Subなど）。
  - 問題データはキャッシュ（Redis）。
  - 同時接続数に合わせた負荷テストシナリオを準備。
  - 履歴テーブルのパーティション分割やアーカイブを検討。

---

## 📝 8. 今後の検討事項リスト

| 検討項目 | 詳細 |
|----------|------|
| ルーム終了後の履歴保持 | Roomを削除するか履歴DBに移すか最終決定。 |
| 問題投稿フロー | 投稿内容の承認方法（自動/手動）、カテゴリ付与の有無。 |
| 回答履歴の保存範囲 | 永続化するか一定期間後に削除するか。 |
| マッチングロジック | 完全ランダムのままかレート帯で分けるか。 |
| CPUプレイヤーの仕様 | 正解率や回答時間の設定などAIロジック詳細。 |
| フレンド機能 | 実装する場合のテーブル設計。多分いらない |
| 近くの人と対戦（WebRTC） | 位置情報の取得、P2P通信構成の可否。 |
| ログ・モニタリング | 障害検知のためのログ収集と接続監視。 |
| セキュリティ | チート・多重ログイン防止策、認証の厳密化。 |
| 負荷テスト | 同時接続数・最大ルーム数のシナリオ設計。 |

---

## ✅ 9. その他

- MVPでは必須機能の安定稼働を最優先。
- 拡張機能は段階的に追加する。
- DB設計はスケーラビリティを意識しておく。

---
